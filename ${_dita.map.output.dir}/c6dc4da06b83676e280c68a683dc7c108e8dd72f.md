<?xml version="1.0" encoding="UTF-8"?><?workdir /C:\Users\Admin\AppData\Local\Temp\temp20190708155216556?><?workdir-uri file:/C:/Users/Admin/AppData/Local/Temp/temp20190708155216556/?><?path2project ..\..\..\?><?path2project-uri ../../../?><?path2rootmap-uri ../../../?><topic xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/" xmlns:dita-ot="http://dita-ot.sourceforge.net/ns/201007/dita-ot" class="- topic/topic " ditaarch:DITAArchVersion="1.2" domains="(topic hi-d) (topic ut-d) (topic indexing-d) (topic hazard-d) (topic abbrev-d) (topic pr-d) (topic sw-d) (topic ui-d)" id="工作原理" xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="topic:1;182:3"><title class="- topic/title " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="title:1;182:3">工作原理</title><body class="- topic/body " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="body:1;182:3"/><topic class="- topic/topic " ditaarch:DITAArchVersion="1.2" domains="(topic hi-d) (topic ut-d) (topic indexing-d) (topic hazard-d) (topic abbrev-d) (topic pr-d) (topic sw-d) (topic ui-d)" id="基本原理" xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="topic:2;182:3"><title class="- topic/title " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="title:2;182:3">基本原理</title><body class="- topic/body " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="body:2;182:3"><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:1;182:3">备份的目标是将数据的当前状态完整地复制到指定的位置。 SMTX OS 的备份模块借助 ZBS 的快照功能来达成这个目标。</p><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:2;182:3">备份被拆分为三个主要步骤：</p><ol class="- topic/ol " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="ol:1;182:3"><li class="- topic/li " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="li:1;182:3"><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:3;182:3">获取当前数据状态。通过快照功能，备份模块可以获取当前的所有保护对象的在同一时刻内的状态（存在微秒级误差），后续单个数据对象的更新将不会影响到需要备份的数据快照；</p></li><li class="- topic/li " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="li:2;182:3"><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:4;182:3">配置同步。备份功能所备份的不仅仅是数据本身，也包括了数据的组织状态，例如虚拟机的配置信息、文件的目录结构等等。在备份开始之前，会首先在保护站点和目标站点之间进行保护对象的配置信息同步，确保在目标站点内创建出所有保护对象的镜像对象；</p></li><li class="- topic/li " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="li:3;182:3"><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:5;182:3">数据同步。在保护站点与目标站点间传输数据快照。</p></li></ol><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:6;182:3">备份模块的克隆与回滚功能的实现原理与备份类似，基本流程均是从快照组中重建数据对象。</p></body></topic><topic class="- topic/topic " ditaarch:DITAArchVersion="1.2" domains="(topic hi-d) (topic ut-d) (topic indexing-d) (topic hazard-d) (topic abbrev-d) (topic pr-d) (topic sw-d) (topic ui-d)" id="传输速率与空间优化" xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="topic:3;182:3"><title class="- topic/title " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="title:3;182:3">传输速率与空间优化</title><body class="- topic/body " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="body:3;182:3"><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:7;182:3">备份通常运行在两个距离较远的站点之间，它们之间的带宽通常较小。为了尽可能充分地利用带宽，减少传输时间，备份功能采用如下策略组合来降低传输的数据量：</p><ol class="- topic/ol " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="ol:2;182:3"><li class="- topic/li " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="li:4;182:3"><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:8;182:3">增量备份：如果保护站点和目标站点曾经完成过一次备份任务，后续任务执行时，都会采用增量备份的方式进行。每次传输的数据仅是当前需要传输的快照组与目标站点已有快照组之间的增量，在数据更新不频繁或更新区域较为集中的场景下可以很大程度地减少传输量；</p></li><li class="- topic/li " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="li:5;182:3"><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:9;182:3">Rsync 同步模式：在变化的数据量中，也会在固定区块内（256MB， ZBS extent 大小）采用 Rsync 模式同步增量，尽可能地利用目标站点已有的数据；</p></li><li class="- topic/li " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="li:6;182:3"><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:10;182:3">空洞避免：在传输时将跳过未写入过的虚拟卷空间，避免传输大量无用数据；</p></li><li class="- topic/li " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="li:7;182:3"><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:11;182:3">数据压缩：多集群间数据备份场景下，在源集群将需要备份的数据进行压缩后再进行网络传输，到备份集群进行解压后备份储存。压缩算法使用 Zstandard，该功能默认开启。</p></li></ol><p class="- topic/p " xtrf="file:/D:/safehaven/content/concepts/backup-service-white-paper/工作原理.md" xtrc="p:12;182:3">同时为降低备份空间成本，目标站点中的数据组织形态为快照链。对于不同时刻快照组间的重复数据将仅保留一份逻辑数据，以减少不必要的空间损耗。同时各个时刻的快照组在逻辑上依旧完整地持有所有数据。删除某个快照对其他快照的数据完整性不会产生影响。</p></body></topic></topic>